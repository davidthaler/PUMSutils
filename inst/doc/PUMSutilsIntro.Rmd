---
title: "Intro to PUMSutils"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Intro to PUMSutils}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(PUMSutils)
```

## ACS PUMS Data

The American Community Survey (ACS) is an annual survey conducted by the U.S. Census Bureau, covering many of the same topics as the decennial census. It is a 1% sample, and it comes in 2 parts: a housing survey of household units and a population survey of people. ACS data is available in several forms. Online, you can get custom tables from [American FactFinder](). Microdata is available through the Public Use Microdata Sample, or PUMS. This contains actual responses to the ACS, one per row. This allows essentially any query to be formed, not just those provided by AFF. However, the data is harder to work with, since every query requires doing tabulation. The `PUMSutils` package reduces this part to function calls.    

The most important thing to know about the ACS PUMS data is that it is a *weighted* sample. 
Each row has an expansion weight indicating the number of households or people represented by this row.
In addition to the main expansion weight, there are 80 weight replicates, which are used for computing standard errors.

In the `PUMSutils` package, the 2015 ACS PUMS housing records for Washington State are included as `wa.house` and Census Bureau-provided ground truth estimates  for some Washington State housing characteristics are provided as `wa.gold`. 
Below we show part of the `wa.gold` data.

```{r gold, echo=FALSE}
# Ground truth for Washington State
wa.gold[c(1, 7),]
```

Here there are 2 characteristics shown, total housing units and the number of units rented for cash.
The column `pums_est_15` has point estimates of these characteristics.
The second column, called `pums_se_15`, has standard errors.
The last column, `pums_moe_15`, is for a 90% confidence interval, so it is just 1.645 * `pums_se_15`.

If we were not using `PUMSutils`, we would compute point estimates like this:

```{r noPUMSutils}
# Sum the weights to estimate a count
sum(wa.house$WGTP)
```

Proportions, various statistics and standard errors can also be computed, 
but the calculations are more involved. 
The `PUMSutils` package simplifies these calculations.

## PUMSutils

Using `PUMSutils` the above example looks like this:

```{r estimate}
estimate(wa.house)
```

In this case, there is no real difference. 
Computing a standard error using the weight replicates is more involved.
See the PUMS technical documentation for details.
Using `PUMSutils` the standard errors are computed with a function `se.estimate`.

```{r se}
se.estimate(wa.house)
```

The value given above in `wa.gold` for `pums_se_15` was 186.
To get estimates for the number of rentals, we first filter the data.
I like to use dplyr for this kind of thing.

```{r rentals}
estimate(filter(wa.house, TEN==3))
```

And we do likewise for standard errors:

```{r se.rentals}
se.estimate(filter(wa.house, TEN==3))
```

Both values match (or round to) those shown in the second line of `wa.gold` above.

## Other statistics

Since the PUMS data is a weighted sample, every calculation on it requires using sample weights. The `PUMSutils` package has functions for computing weighted means, quantiles and tables, and for computing proportions and their standard errors.
Here we compute the fraction of Washington State housing units that are rented for cash (TEN=3), again using `dplyr` for the filtering.

```{r prop}
proportion(filter(wa.house, TEN==3), wa.house)
```

About 1 in 3 Washington State housing units is a rental. 
Standard errors for the proportion are coomputed using `se.proportion`.

```{r se.prop}
se.proportion(filter(wa.house, TEN==3), wa.house)
```

The functions for means, quantiles and table in `PUMSutils` are prepended with `acs` to avoid name clashes. 
Here we compute a table of housing units by tenure type:

```{r table}
acs.table(wa.house, 'TEN')
```

Field values in the ACS PUMS data are coded as integers. 
In general, you will have to look at the data dictionary for the definitions.
For the `wa.house` data, you can use `?wa.house` to get help for this data set.
The values here are:

1. owned free and clear
2. owned with mortgage
3. rented for cash
4. occupied w/o payment

Check the `PUMSutils` documentation for the remaining functions.


